import{S as fe,i as pe,s as ue,L as _e,c as S,f as j,a as F,l as k,t as g,b as h,v as C,d as E,o as ce,H as me,x as Q,y as te,e as y,g as W,h as Z,n as b,q as x,A as ne,r as re,u as ie,M as de,z as U,_ as $e,a2 as ge,a6 as q,a7 as se,C as be,j as Y,k as he,p as le,w as we,aj as ee,a3 as ye,ai as ke,ag as Ce,ah as D,a5 as Le,aa as ve,ab as Se}from"./Layout-2c5c8e4b.js";import{L as Fe,C as Ee,O as Me,_ as Ne,J as Oe,a as je,G as Be,P as Pe}from"./index-a7c406b6.js";function oe(l){let e,n,t,a,s,r,i,u,w,c,d,$,m,M,N,L,G,A,J,_,p,O,T,H,I;const R=[Te,qe],B=[];function X(o,f){return o[5]=="lts"?0:1}d=X(l),$=B[d]=R[d](l);function V(o){l[23](o)}let z={};return l[1]!==void 0&&(z.cost=l[1]),p=new je({props:z}),Q.push(()=>te(p,"cost",V)),{c(){e=y("hr"),n=j(),t=y("div"),a=y("label"),s=W(`Color edges by:
          `),r=y("select"),i=y("option"),i.textContent="LTS",u=y("option"),u.textContent="Edge cost (relative to length)",w=y("option"),w.textContent="Nearby amenities",c=j(),$.c(),m=j(),M=y("div"),N=y("label"),L=y("input"),G=W(`
          Show cyclists not allowed`),A=j(),J=y("hr"),_=j(),S(p.$$.fragment),i.__value="lts",Y(i,i.__value),u.__value="cost",Y(u,u.__value),w.__value="nearby_amenities",Y(w,w.__value),l[5]===void 0&&he(()=>l[21].call(r)),Z(L,"type","checkbox"),U(N,"color",q.lts_not_allowed)},m(o,f){k(o,e,f),k(o,n,f),k(o,t,f),b(t,a),b(a,s),b(a,r),b(r,i),b(r,u),b(r,w),le(r,l[5],!0),k(o,c,f),B[d].m(o,f),k(o,m,f),k(o,M,f),b(M,N),b(N,L),L.checked=l[6],b(N,G),k(o,A,f),k(o,J,f),k(o,_,f),F(p,o,f),T=!0,H||(I=[x(r,"change",l[21]),x(L,"change",l[22])],H=!0)},p(o,f){f&32&&le(r,o[5]);let v=d;d=X(o),d===v?B[d].p(o,f):(re(),h(B[v],1,1,()=>{B[v]=null}),ie(),$=B[d],$?$.p(o,f):($=B[d]=R[d](o),$.c()),g($,1),$.m(m.parentNode,m)),f&64&&(L.checked=o[6]);const P={};!O&&f&2&&(O=!0,P.cost=o[1],ne(()=>O=!1)),p.$set(P)},i(o){T||(g($),g(p.$$.fragment,o),T=!0)},o(o){h($),h(p.$$.fragment,o),T=!1},d(o){o&&(C(e),C(n),C(t),C(c),C(m),C(M),C(A),C(J),C(_)),B[d].d(o),E(p,o),H=!1,we(I)}}}function qe(l){let e,n;return e=new ke({props:{colorScale:ee,limits:K(l[5],l[9],l[10]),decimalPlaces:1}}),{c(){S(e.$$.fragment)},m(t,a){F(e,t,a),n=!0},p(t,a){const s={};a&1568&&(s.limits=K(t[5],t[9],t[10])),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Te(l){let e,n,t,a;return e=new Ce({props:{rows:[[`${D.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,q.lts1],[`${D.lts2}: ${l[8][2].toFixed(0)}%`,q.lts2],[`${D.lts3}: ${l[8][3].toFixed(0)}%`,q.lts3],[`${D.lts4}: ${l[8][4].toFixed(0)}%`,q.lts4]]}}),{c(){S(e.$$.fragment),n=j(),t=y("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,r){F(e,s,r),k(s,n,r),k(s,t,r),a=!0},p(s,r){const i={};r&256&&(i.rows=[[`${D.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,q.lts1],[`${D.lts2}: ${s[8][2].toFixed(0)}%`,q.lts2],[`${D.lts3}: ${s[8][3].toFixed(0)}%`,q.lts3],[`${D.lts4}: ${s[8][4].toFixed(0)}%`,q.lts4]]),e.$set(i)},i(s){a||(g(e.$$.fragment,s),a=!0)},o(s){h(e.$$.fragment,s),a=!1},d(s){s&&(C(n),C(t)),E(e,s)}}}function Ae(l){let e,n,t,a,s,r,i,u,w,c,d,$,m,M,N,L,G;n=new me({props:{app:"costs"}});function A(p){l[18](p)}let J={};l[0]!==void 0&&(J.example=l[0]),c=new Ee({props:J}),Q.push(()=>te(c,"example",A)),m=new Me({props:{map:l[2]}}),m.$on("gotXml",l[15]),m.$on("loading",l[19]),m.$on("error",l[20]);let _=l[3]&&oe(l);return{c(){e=y("div"),S(n.$$.fragment),t=j(),a=y("label"),s=W("Open an "),r=y("i"),r.textContent=".osm.pbf",i=W(`
      file
      `),u=y("input"),w=j(),S(c.$$.fragment),$=j(),S(m.$$.fragment),M=j(),_&&_.c(),Z(u,"type","file"),Z(e,"slot","left")},m(p,O){k(p,e,O),F(n,e,null),b(e,t),b(e,a),b(a,s),b(a,r),b(a,i),b(a,u),l[17](u),b(e,w),F(c,e,null),b(e,$),F(m,e,null),b(e,M),_&&_.m(e,null),N=!0,L||(G=x(u,"change",l[12]),L=!0)},p(p,O){const T={};!d&&O&1&&(d=!0,T.example=p[0],ne(()=>d=!1)),c.$set(T);const H={};O&4&&(H.map=p[2]),m.$set(H),p[3]?_?(_.p(p,O),O&8&&g(_,1)):(_=oe(p),_.c(),g(_,1),_.m(e,null)):_&&(re(),h(_,1,1,()=>{_=null}),ie())},i(p){N||(g(n.$$.fragment,p),g(c.$$.fragment,p),g(m.$$.fragment,p),g(_),N=!0)},o(p){h(n.$$.fragment,p),h(c.$$.fragment,p),h(m.$$.fragment,p),h(_),N=!1},d(p){p&&C(e),E(n),l[17](null),E(c),E(m),_&&_.d(),L=!1,G()}}}function Je(l){let e,n;return e=new Se({props:{properties:l[28]}}),{c(){S(e.$$.fragment)},m(t,a){F(e,t,a),n=!0},p(t,a){const s={};a&268435456&&(s.properties=t[28]),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function He(l){let e,n;return e=new ve({props:{$$slots:{default:[Je,({props:t})=>({28:t}),({props:t})=>t?268435456:0]},$$scope:{ctx:l}}}),{c(){S(e.$$.fragment)},m(t,a){F(e,t,a),n=!0},p(t,a){const s={};a&805306368&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function De(l){let e,n;return e=new Le({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[13](l[5],l[9],l[10]),"line-opacity":l[14](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[He]},$$scope:{ctx:l}}}),e.$on("click",Xe),{c(){S(e.$$.fragment)},m(t,a){F(e,t,a),n=!0},p(t,a){const s={};a&1632&&(s.paint={"line-width":5,"line-color":t[13](t[5],t[9],t[10]),"line-opacity":t[14](t[5],t[6])}),a&536870912&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ge(l){let e,n,t,a;return e=new Be({props:{data:l[4],$$slots:{default:[De]},$$scope:{ctx:l}}}),t=new Pe({}),{c(){S(e.$$.fragment),n=j(),S(t.$$.fragment)},m(s,r){F(e,s,r),k(s,n,r),F(t,s,r),a=!0},p(s,r){const i={};r&16&&(i.data=s[4]),r&536872544&&(i.$$scope={dirty:r,ctx:s}),e.$set(i)},i(s){a||(g(e.$$.fragment,s),g(t.$$.fragment,s),a=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),a=!1},d(s){s&&C(n),E(e,s),E(t,s)}}}function Ie(l){let e,n,t,a;function s(i){l[16](i)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ge]},$$scope:{ctx:l}};return l[2]!==void 0&&(r.map=l[2]),n=new de({props:r}),Q.push(()=>te(n,"map",s)),{c(){e=y("div"),S(n.$$.fragment),Z(e,"slot","main"),U(e,"position","relative"),U(e,"width","100%"),U(e,"height","100vh")},m(i,u){k(i,e,u),F(n,e,null),a=!0},p(i,u){const w={};u&536872560&&(w.$$scope={dirty:u,ctx:i}),!t&&u&4&&(t=!0,w.map=i[2],ne(()=>t=!1)),n.$set(w)},i(i){a||(g(n.$$.fragment,i),a=!0)},o(i){h(n.$$.fragment,i),a=!1},d(i){i&&C(e),E(n)}}}function Re(l){let e,n,t,a;return e=new _e({props:{$$slots:{main:[Ie],left:[Ae]},$$scope:{ctx:l}}}),t=new Fe({props:{loading:l[7]}}),{c(){S(e.$$.fragment),n=j(),S(t.$$.fragment)},m(s,r){F(e,s,r),k(s,n,r),F(t,s,r),a=!0},p(s,[r]){const i={};r&536875007&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const u={};r&128&&(u.loading=s[7]),t.$set(u)},i(s){a||(g(e.$$.fragment,s),g(t.$$.fragment,s),a=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),a=!1},d(s){s&&C(n),E(e,s),E(t,s)}}}function Xe(l){let e=l.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function K(l,e,n){if(l=="lts")return[];if(l=="cost")return ae(0,e);if(l=="nearby_amenities")return ae(0,n);throw new Error("unreachable")}function ae(l,e){let n=[],t=(e-l)/5;for(let a=0;a<6;a++)n.push(l+a*t);return n}function ze(l,e,n){ce(async()=>{await Ne(),await $e()});let t,a,s="",r={type:"FeatureCollection",features:[]},i="Distance",u="cost",w=!1,c="",d=[0,0,0,0,0],$=1,m=1,M;async function N(o){n(0,s=""),n(7,c="Loading file"),L(await M.files[0].arrayBuffer())}function L(o){try{n(3,a=new Oe(new Uint8Array(o))),n(1,i="Distance");let f=a.getBounds();t.fitBounds([[f[0],f[1]],[f[2],f[3]]],{padding:20,animate:!1}),A()}catch(f){window.alert(`Problem importing osm.pbf file: ${f}`)}n(7,c="")}async function G(o){if(o!=""){n(7,c=`Loading ${o}`);let f=await fetch(`https://assets.od2net.org/pbf_clips/${o}.osm.pbf`);L(await f.arrayBuffer())}}function A(){n(4,r=JSON.parse(a.debugNetwork()));let o=0,f=[0,0,0,0,0];n(9,$=0),n(10,m=0);for(let v of r.features){let P=v.properties;n(10,m=Math.max(m,P.nearby_amenities)),P.length&&(n(9,$=Math.max($,P.forward_cost/P.length)),o+=P.length,f[P.lts]+=P.length)}n(8,d=f.map(v=>v/o*100))}function J(o,f,v){if(o=="lts")return ge;if(o=="cost")return["case",["==",0,["get","lts"]],q.lts_not_allowed,se(["/",["get","forward_cost"],["get","length"]],K(o,f,v),ee)];if(o=="nearby_amenities")return se(["get","nearby_amenities"],K(o,f,v),ee);throw new Error("unreachable")}function _(o,f){let v=ye(1,.5);return o=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,v]:f?v:["case",["==",0,["get","lts"]],0,v]}function p(o){n(7,c="Parsing XML"),L(new TextEncoder().encode(o.detail)),n(7,c="")}function O(o){a&&(a.updateCostFunction(o),A())}function T(o){t=o,n(2,t)}function H(o){Q[o?"unshift":"push"](()=>{M=o,n(11,M)})}function I(o){s=o,n(0,s)}const R=o=>n(7,c=o.detail),B=o=>n(7,c=o.detail);function X(){u=be(this),n(5,u)}function V(){w=this.checked,n(6,w)}function z(o){i=o,n(1,i)}return l.$$.update=()=>{l.$$.dirty&1&&G(s),l.$$.dirty&2&&O(i)},[s,i,t,a,r,u,w,c,d,$,m,M,N,J,_,p,T,H,I,R,B,X,V,z]}class Ue extends fe{constructor(e){super(),pe(this,e,ze,Re,ue,{})}}new Ue({target:document.getElementById("app")});
