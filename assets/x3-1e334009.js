import{S as fe,i as pe,s as ue,L as me,c as F,f as E,a as v,l as k,t as g,b as h,v as L,d as M,o as ce,H as _e,x as Q,y as te,e as y,g as W,h as Z,n as b,q as x,A as ne,r as ae,u as ie,M as de,z as U,_ as $e,a0 as ge,a4 as q,a6 as se,C as be,j as Y,k as he,p as le,w as we,ai as ee,a1 as ye,ah as ke,af as Le,ag as D,a3 as Ce,a9 as Se,aa as Fe}from"./Layout-e3c78437.js";import{L as ve,C as Me,O as Ne,_ as Oe,J as Be,a as Ee,G as Pe,P as je}from"./CostFunction-6f46faef.js";function oe(l){let e,n,t,r,s,a,i,u,w,c,d,$,_,N,O,C,G,J,A,m,p,B,T,H,I;const R=[Te,qe],P=[];function X(o,f){return o[5]=="lts"?0:1}d=X(l),$=P[d]=R[d](l);function V(o){l[23](o)}let z={};return l[1]!==void 0&&(z.cost=l[1]),p=new Ee({props:z}),Q.push(()=>te(p,"cost",V)),{c(){e=y("hr"),n=E(),t=y("div"),r=y("label"),s=W(`Color edges by:
          `),a=y("select"),i=y("option"),i.textContent="LTS",u=y("option"),u.textContent="Edge cost (relative to length)",w=y("option"),w.textContent="Nearby amenities",c=E(),$.c(),_=E(),N=y("div"),O=y("label"),C=y("input"),G=W(`
          Show cyclists not allowed`),J=E(),A=y("hr"),m=E(),F(p.$$.fragment),i.__value="lts",Y(i,i.__value),u.__value="cost",Y(u,u.__value),w.__value="nearby_amenities",Y(w,w.__value),l[5]===void 0&&he(()=>l[21].call(a)),Z(C,"type","checkbox"),U(O,"color",q.lts_not_allowed)},m(o,f){k(o,e,f),k(o,n,f),k(o,t,f),b(t,r),b(r,s),b(r,a),b(a,i),b(a,u),b(a,w),le(a,l[5],!0),k(o,c,f),P[d].m(o,f),k(o,_,f),k(o,N,f),b(N,O),b(O,C),C.checked=l[6],b(O,G),k(o,J,f),k(o,A,f),k(o,m,f),v(p,o,f),T=!0,H||(I=[x(a,"change",l[21]),x(C,"change",l[22])],H=!0)},p(o,f){f&32&&le(a,o[5]);let S=d;d=X(o),d===S?P[d].p(o,f):(ae(),h(P[S],1,1,()=>{P[S]=null}),ie(),$=P[d],$?$.p(o,f):($=P[d]=R[d](o),$.c()),g($,1),$.m(_.parentNode,_)),f&64&&(C.checked=o[6]);const j={};!B&&f&2&&(B=!0,j.cost=o[1],ne(()=>B=!1)),p.$set(j)},i(o){T||(g($),g(p.$$.fragment,o),T=!0)},o(o){h($),h(p.$$.fragment,o),T=!1},d(o){o&&(L(e),L(n),L(t),L(c),L(_),L(N),L(J),L(A),L(m)),P[d].d(o),M(p,o),H=!1,we(I)}}}function qe(l){let e,n;return e=new ke({props:{colorScale:ee,limits:K(l[5],l[9],l[10]),decimalPlaces:1}}),{c(){F(e.$$.fragment)},m(t,r){v(e,t,r),n=!0},p(t,r){const s={};r&1568&&(s.limits=K(t[5],t[9],t[10])),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function Te(l){let e,n,t,r;return e=new Le({props:{rows:[[`${D.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,q.lts1],[`${D.lts2}: ${l[8][2].toFixed(0)}%`,q.lts2],[`${D.lts3}: ${l[8][3].toFixed(0)}%`,q.lts3],[`${D.lts4}: ${l[8][4].toFixed(0)}%`,q.lts4]]}}),{c(){F(e.$$.fragment),n=E(),t=y("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,a){v(e,s,a),k(s,n,a),k(s,t,a),r=!0},p(s,a){const i={};a&256&&(i.rows=[[`${D.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,q.lts1],[`${D.lts2}: ${s[8][2].toFixed(0)}%`,q.lts2],[`${D.lts3}: ${s[8][3].toFixed(0)}%`,q.lts3],[`${D.lts4}: ${s[8][4].toFixed(0)}%`,q.lts4]]),e.$set(i)},i(s){r||(g(e.$$.fragment,s),r=!0)},o(s){h(e.$$.fragment,s),r=!1},d(s){s&&(L(n),L(t)),M(e,s)}}}function Je(l){let e,n,t,r,s,a,i,u,w,c,d,$,_,N,O,C,G;n=new _e({props:{app:"costs"}});function J(p){l[18](p)}let A={};l[0]!==void 0&&(A.example=l[0]),c=new Me({props:A}),Q.push(()=>te(c,"example",J)),_=new Ne({props:{map:l[2]}}),_.$on("gotXml",l[15]),_.$on("loading",l[19]),_.$on("error",l[20]);let m=l[3]&&oe(l);return{c(){e=y("div"),F(n.$$.fragment),t=E(),r=y("label"),s=W("Open an "),a=y("i"),a.textContent=".osm.pbf",i=W(`
      file
      `),u=y("input"),w=E(),F(c.$$.fragment),$=E(),F(_.$$.fragment),N=E(),m&&m.c(),Z(u,"type","file"),Z(e,"slot","left")},m(p,B){k(p,e,B),v(n,e,null),b(e,t),b(e,r),b(r,s),b(r,a),b(r,i),b(r,u),l[17](u),b(e,w),v(c,e,null),b(e,$),v(_,e,null),b(e,N),m&&m.m(e,null),O=!0,C||(G=x(u,"change",l[12]),C=!0)},p(p,B){const T={};!d&&B&1&&(d=!0,T.example=p[0],ne(()=>d=!1)),c.$set(T);const H={};B&4&&(H.map=p[2]),_.$set(H),p[3]?m?(m.p(p,B),B&8&&g(m,1)):(m=oe(p),m.c(),g(m,1),m.m(e,null)):m&&(ae(),h(m,1,1,()=>{m=null}),ie())},i(p){O||(g(n.$$.fragment,p),g(c.$$.fragment,p),g(_.$$.fragment,p),g(m),O=!0)},o(p){h(n.$$.fragment,p),h(c.$$.fragment,p),h(_.$$.fragment,p),h(m),O=!1},d(p){p&&L(e),M(n),l[17](null),M(c),M(_),m&&m.d(),C=!1,G()}}}function Ae(l){let e,n;return e=new Fe({props:{properties:l[28]}}),{c(){F(e.$$.fragment)},m(t,r){v(e,t,r),n=!0},p(t,r){const s={};r&268435456&&(s.properties=t[28]),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function He(l){let e,n;return e=new Se({props:{$$slots:{default:[Ae,({props:t})=>({28:t}),({props:t})=>t?268435456:0]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},m(t,r){v(e,t,r),n=!0},p(t,r){const s={};r&805306368&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function De(l){let e,n;return e=new Ce({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[13](l[5],l[9],l[10]),"line-opacity":l[14](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[He]},$$scope:{ctx:l}}}),e.$on("click",Xe),{c(){F(e.$$.fragment)},m(t,r){v(e,t,r),n=!0},p(t,r){const s={};r&1632&&(s.paint={"line-width":5,"line-color":t[13](t[5],t[9],t[10]),"line-opacity":t[14](t[5],t[6])}),r&536870912&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function Ge(l){let e,n,t,r;return e=new Pe({props:{data:l[4],$$slots:{default:[De]},$$scope:{ctx:l}}}),t=new je({}),{c(){F(e.$$.fragment),n=E(),F(t.$$.fragment)},m(s,a){v(e,s,a),k(s,n,a),v(t,s,a),r=!0},p(s,a){const i={};a&16&&(i.data=s[4]),a&536872544&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){r||(g(e.$$.fragment,s),g(t.$$.fragment,s),r=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),r=!1},d(s){s&&L(n),M(e,s),M(t,s)}}}function Ie(l){let e,n,t,r;function s(i){l[16](i)}let a={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ge]},$$scope:{ctx:l}};return l[2]!==void 0&&(a.map=l[2]),n=new de({props:a}),Q.push(()=>te(n,"map",s)),{c(){e=y("div"),F(n.$$.fragment),Z(e,"slot","main"),U(e,"position","relative"),U(e,"width","100%"),U(e,"height","100vh")},m(i,u){k(i,e,u),v(n,e,null),r=!0},p(i,u){const w={};u&536872560&&(w.$$scope={dirty:u,ctx:i}),!t&&u&4&&(t=!0,w.map=i[2],ne(()=>t=!1)),n.$set(w)},i(i){r||(g(n.$$.fragment,i),r=!0)},o(i){h(n.$$.fragment,i),r=!1},d(i){i&&L(e),M(n)}}}function Re(l){let e,n,t,r;return e=new me({props:{$$slots:{main:[Ie],left:[Je]},$$scope:{ctx:l}}}),t=new ve({props:{loading:l[7]}}),{c(){F(e.$$.fragment),n=E(),F(t.$$.fragment)},m(s,a){v(e,s,a),k(s,n,a),v(t,s,a),r=!0},p(s,[a]){const i={};a&536875007&&(i.$$scope={dirty:a,ctx:s}),e.$set(i);const u={};a&128&&(u.loading=s[7]),t.$set(u)},i(s){r||(g(e.$$.fragment,s),g(t.$$.fragment,s),r=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),r=!1},d(s){s&&L(n),M(e,s),M(t,s)}}}function Xe(l){let e=l.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function K(l,e,n){if(l=="lts")return[];if(l=="cost")return re(0,e);if(l=="nearby_amenities")return re(0,n);throw new Error("unreachable")}function re(l,e){let n=[],t=(e-l)/5;for(let r=0;r<6;r++)n.push(l+r*t);return n}function ze(l,e,n){ce(async()=>{await Oe(),await $e()});let t,r,s="",a={type:"FeatureCollection",features:[]},i="Distance",u="cost",w=!1,c="",d=[0,0,0,0,0],$=1,_=1,N;async function O(o){n(0,s=""),n(7,c="Loading file"),C(await N.files[0].arrayBuffer())}function C(o){try{n(3,r=new Be(new Uint8Array(o))),n(1,i="Distance");let f=r.getBounds();t.fitBounds([[f[0],f[1]],[f[2],f[3]]],{padding:20,animate:!1}),J()}catch(f){window.alert(`Problem importing osm.pbf file: ${f}`)}n(7,c="")}async function G(o){if(o!=""){n(7,c=`Loading ${o}`);let f=await fetch(`https://assets.od2net.org/pbf_clips/${o}.osm.pbf`);C(await f.arrayBuffer())}}function J(){n(4,a=JSON.parse(r.debugNetwork()));let o=0,f=[0,0,0,0,0];n(9,$=0),n(10,_=0);for(let S of a.features){let j=S.properties;n(10,_=Math.max(_,j.nearby_amenities)),j.length&&(n(9,$=Math.max($,j.forward_cost/j.length)),o+=j.length,f[j.lts]+=j.length)}n(8,d=f.map(S=>S/o*100))}function A(o,f,S){if(o=="lts")return ge;if(o=="cost")return["case",["==",0,["get","lts"]],q.lts_not_allowed,se(["/",["get","forward_cost"],["get","length"]],K(o,f,S),ee)];if(o=="nearby_amenities")return se(["get","nearby_amenities"],K(o,f,S),ee);throw new Error("unreachable")}function m(o,f){let S=ye(1,.5);return o=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,S]:f?S:["case",["==",0,["get","lts"]],0,S]}function p(o){n(7,c="Parsing XML"),C(new TextEncoder().encode(o.detail)),n(7,c="")}function B(o){r&&(r.updateCostFunction(o),J())}function T(o){t=o,n(2,t)}function H(o){Q[o?"unshift":"push"](()=>{N=o,n(11,N)})}function I(o){s=o,n(0,s)}const R=o=>n(7,c=o.detail),P=o=>n(7,c=o.detail);function X(){u=be(this),n(5,u)}function V(){w=this.checked,n(6,w)}function z(o){i=o,n(1,i)}return l.$$.update=()=>{l.$$.dirty&1&&G(s),l.$$.dirty&2&&B(i)},[s,i,t,r,a,u,w,c,d,$,_,N,O,A,m,p,T,H,I,R,P,X,V,z]}class Ue extends fe{constructor(e){super(),pe(this,e,ze,Re,ue,{})}}new Ue({target:document.getElementById("app")});
