import{S as le,i as ae,s as G,m as re,P as se,L as ue,c as O,a as D,t as g,b,d as B,o as pe,H as fe,e as d,f as H,g as z,h as F,j as w,k as me,l as C,n as m,p as K,q as X,r as P,u as R,v as S,w as ce,M as _e,x as U,y as J,z as Z,A as T,_ as de,B as W,F as ge,C as be,D as ie,E as he}from"./SequentialLegend-423670eb.js";import{S as ve,L as Ae}from"./SidebarControls-5b377969.js";const we="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAm0lEQVRIS+2U0Q2AIAxEYQM30Q3UDXQy3UhHkE0cweuHHxKTXpuQaALJ/cE9eoXGUHjFwv6hAtSEPxFRh2su0Ayd6pWzDUwFO8700AGNVggDaGAqkNYDYQBStBvCAtwQC8AF8QA2kORlJWjQmm4BSB9M5lIyC3CZswC3OQu4PxqVef7TmYikoSs0aQ19GyMMwDp+HvsrQI3v/xFduXoiGbi1DtQAAAAASUVORK5CYII=";let q="pmtilesSource";async function ke(l){let e=await l.getHeader(),o=await l.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(o.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function ye(l,e,o){let{pmtiles:t}=e,{map:n}=e,{outputMetadata:a=null}=e,i=new se;re.addProtocol("pmtiles",i.tile);async function p(s){r(q),i.add(s);let f=await ke(s);n.addSource(q,{type:"vector",tiles:["pmtiles://"+s.source.getKey()+"/{z}/{x}/{y}"],minzoom:f.minZoom,maxzoom:f.maxZoom,bounds:f.bounds}),n.fitBounds(f.bounds,{padding:100,duration:500}),o(0,a=f.outputMetadata)}function r(s){if(n.getSource(s)){let f=[];for(let u of n.getStyle().layers)"source"in u&&u.source==s&&f.push(u.id);for(let u of f)n.removeLayer(u);n.removeSource(s)}}return l.$$set=s=>{"pmtiles"in s&&o(1,t=s.pmtiles),"map"in s&&o(2,n=s.map),"outputMetadata"in s&&o(0,a=s.outputMetadata)},l.$$.update=()=>{l.$$.dirty&2&&(t?p(t):r(q))},[a,t,n]}class $e extends le{constructor(e){super(),ae(this,e,ye,null,G,{pmtiles:1,map:2,outputMetadata:0})}}function x(l){let e,o,t;return{c(){e=z("Open a "),o=d("i"),o.textContent=".pmtiles",t=z(`
        file produced by the tool. Note this file stays in your browser; it doesn't
        get uploaded anywhere.`)},m(n,a){C(n,e,a),C(n,o,a),C(n,t,a)},d(n){n&&(S(e),S(o),S(t))}}}function ee(l){let e,o,t;function n(i){l[12](i)}let a={outputMetadata:l[3],map:l[1]};return l[4]!==void 0&&(a.controls=l[4]),e=new ve({props:a}),U.push(()=>J(e,"controls",n)),{c(){O(e.$$.fragment)},m(i,p){D(e,i,p),t=!0},p(i,p){const r={};p&8&&(r.outputMetadata=i[3]),p&2&&(r.map=i[1]),!o&&p&16&&(o=!0,r.controls=i[4],T(()=>o=!1)),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function Me(l){let e,o,t,n,a,i,p,r,s,f,u,k,y,$,M,c,A,L,Q,E,V,N,Y,j;o=new fe({props:{app:"main"}});let h=l[2]==null&&x(),_=l[3]&&ee(l);return{c(){e=d("div"),O(o.$$.fragment),t=H(),n=d("label"),h&&h.c(),a=H(),i=d("input"),p=H(),r=d("div"),s=d("label"),f=z(`Or load an example:
        `),u=d("select"),k=d("option"),k.textContent="Custom file loaded",y=d("option"),y.textContent="Edinburgh",$=d("option"),$.textContent=`England (2011 home-to-work)
          `,M=d("option"),M.textContent="Liverpool (direct)",c=d("option"),c.textContent="Liverpool (quiet)",A=d("option"),A.textContent="London",L=d("option"),L.textContent="Seattle",Q=d("option"),Q.textContent="York",E=d("option"),E.textContent="Lisbon",V=H(),_&&_.c(),F(i,"type","file"),k.__value="",w(k,k.__value),y.__value="edinburgh",w(y,y.__value),$.__value="england_2011_home_to_work",w($,$.__value),M.__value="liverpool_direct",w(M,M.__value),c.__value="liverpool_quiet",w(c,c.__value),A.__value="london",w(A,A.__value),L.__value="seattle",w(L,L.__value),Q.__value="york",w(Q,Q.__value),E.__value="lisbon",w(E,E.__value),l[0]===void 0&&me(()=>l[11].call(u)),F(e,"slot","left")},m(v,I){C(v,e,I),D(o,e,null),m(e,t),m(e,n),h&&h.m(n,null),m(n,a),m(n,i),l[10](i),m(e,p),m(e,r),m(r,s),m(s,f),m(s,u),m(u,k),m(u,y),m(u,$),m(u,M),m(u,c),m(u,A),m(u,L),m(u,Q),m(u,E),K(u,l[0],!0),m(e,V),_&&_.m(e,null),N=!0,Y||(j=[X(i,"change",l[6]),X(u,"change",l[11])],Y=!0)},p(v,I){v[2]==null?h||(h=x(),h.c(),h.m(n,a)):h&&(h.d(1),h=null),I&1&&K(u,v[0]),v[3]?_?(_.p(v,I),I&8&&g(_,1)):(_=ee(v),_.c(),g(_,1),_.m(e,null)):_&&(P(),b(_,1,1,()=>{_=null}),R())},i(v){N||(g(o.$$.fragment,v),g(_),N=!0)},o(v){b(o.$$.fragment,v),b(_),N=!1},d(v){v&&S(e),B(o),h&&h.d(),l[10](null),_&&_.d(),Y=!1,ce(j)}}}function te(l){let e=l[3],o,t,n=oe(l);return{c(){n.c(),o=ie()},m(a,i){n.m(a,i),C(a,o,i),t=!0},p(a,i){i&8&&G(e,e=a[3])?(P(),b(n,1,1,he),R(),n=oe(a),n.c(),g(n,1),n.m(o.parentNode,o)):n.p(a,i)},i(a){t||(g(n),t=!0)},o(a){b(n),t=!1},d(a){a&&S(o),n.d(a)}}}function oe(l){let e,o;return e=new Ae({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:l[4]}}),{c(){O(e.$$.fragment)},m(t,n){D(e,t,n),o=!0},p(t,n){const a={};n&16&&(a.controls=t[4]),e.$set(a)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){B(e,t)}}}function Ce(l){let e,o,t=l[3]&&te(l);return{c(){t&&t.c(),e=ie()},m(n,a){t&&t.m(n,a),C(n,e,a),o=!0},p(n,a){n[3]?t?(t.p(n,a),a&8&&g(t,1)):(t=te(n),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(P(),b(t,1,1,()=>{t=null}),R())},i(n){o||(g(t),o=!0)},o(n){b(t),o=!1},d(n){n&&S(e),t&&t.d(n)}}}function ne(l){let e,o,t;function n(i){l[9](i)}let a={map:l[1],pmtiles:l[2]};return l[3]!==void 0&&(a.outputMetadata=l[3]),e=new $e({props:a}),U.push(()=>J(e,"outputMetadata",n)),{c(){O(e.$$.fragment)},m(i,p){D(e,i,p),t=!0},p(i,p){const r={};p&2&&(r.map=i[1]),p&4&&(r.pmtiles=i[2]),!o&&p&8&&(o=!0,r.outputMetadata=i[3],T(()=>o=!1)),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function Se(l){let e,o,t,n,a;function i(s){l[7](s)}let p={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,images:[{id:"chevron",url:we}],$$slots:{default:[Ce]},$$scope:{ctx:l}};l[1]!==void 0&&(p.map=l[1]),o=new _e({props:p}),U.push(()=>J(o,"map",i)),o.$on("error",l[8]);let r=l[1]&&ne(l);return{c(){e=d("div"),O(o.$$.fragment),n=H(),r&&r.c(),F(e,"slot","main"),Z(e,"position","relative"),Z(e,"width","100%"),Z(e,"height","100vh")},m(s,f){C(s,e,f),D(o,e,null),m(e,n),r&&r.m(e,null),a=!0},p(s,f){const u={};f&8216&&(u.$$scope={dirty:f,ctx:s}),!t&&f&2&&(t=!0,u.map=s[1],T(()=>t=!1)),o.$set(u),s[1]?r?(r.p(s,f),f&2&&g(r,1)):(r=ne(s),r.c(),g(r,1),r.m(e,null)):r&&(P(),b(r,1,1,()=>{r=null}),R())},i(s){a||(g(o.$$.fragment,s),g(r),a=!0)},o(s){b(o.$$.fragment,s),b(r),a=!1},d(s){s&&S(e),B(o),r&&r.d()}}}function Le(l){let e,o;return e=new ue({props:{$$slots:{main:[Se],left:[Me]},$$scope:{ctx:l}}}),{c(){O(e.$$.fragment)},m(t,n){D(e,t,n),o=!0},p(t,[n]){const a={};n&8255&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){B(e,t)}}}function Qe(l,e,o){pe(async()=>{await de()});let t,n,a="",i,p={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},r;function s(c){try{o(0,a="");let A=r.files;o(2,n=new W(new ge(A[0])))}catch(A){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${A}`)}}function f(c){t=c,o(1,t)}const u=c=>console.log(c.detail);function k(c){i=c,o(3,i)}function y(c){U[c?"unshift":"push"](()=>{r=c,o(5,r)})}function $(){a=be(this),o(0,a)}function M(c){p=c,o(4,p)}return l.$$.update=()=>{l.$$.dirty&1&&a!=""&&o(2,n=new W(`https://assets.od2net.org/output/${a}.pmtiles`))},[a,t,n,i,p,r,s,f,u,k,y,$,M]}class Ee extends le{constructor(e){super(),ae(this,e,Qe,Le,G,{})}}new Ee({target:document.getElementById("app")});
