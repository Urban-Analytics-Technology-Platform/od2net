import{S as ae,i as ie,s as J,m as ue,P as pe,L as fe,c as B,a as I,t as g,b,d as H,o as ce,H as me,e as m,f as D,g as C,n as re,h as S,j as P,k as G,l as y,p as _e,q as c,r as X,u as W,v as U,w as Y,x as de,M as ge,y as Z,z as T,A as z,B as V,_ as be,C as x,F as he,D as ve,E as se}from"./Layout-a6e3acf3.js";import{S as Ae,L as ye}from"./SidebarControls-fe6e8fa8.js";const we="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAm0lEQVRIS+2U0Q2AIAxEYQM30Q3UDXQy3UhHkE0cweuHHxKTXpuQaALJ/cE9eoXGUHjFwv6hAtSEPxFRh2su0Ayd6pWzDUwFO8700AGNVggDaGAqkNYDYQBStBvCAtwQC8AF8QA2kORlJWjQmm4BSB9M5lIyC3CZswC3OQu4PxqVef7TmYikoSs0aQ19GyMMwDp+HvsrQI3v/xFduXoiGbi1DtQAAAAASUVORK5CYII=";let F="pmtilesSource";async function ke(a){let e=await a.getHeader(),o=await a.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(o.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function $e(a,e,o){let{pmtiles:t}=e,{map:n}=e,{outputMetadata:l=null}=e,i=new pe;ue.addProtocol("pmtiles",i.tile);async function p(s){r(F),i.add(s);let f=await ke(s);n.addSource(F,{type:"vector",tiles:["pmtiles://"+s.source.getKey()+"/{z}/{x}/{y}"],minzoom:f.minZoom,maxzoom:f.maxZoom,bounds:f.bounds}),n.fitBounds(f.bounds,{padding:100,duration:500}),o(0,l=f.outputMetadata)}function r(s){if(n.getSource(s)){let f=[];for(let u of n.getStyle().layers)"source"in u&&u.source==s&&f.push(u.id);for(let u of f)n.removeLayer(u);n.removeSource(s)}}return a.$$set=s=>{"pmtiles"in s&&o(1,t=s.pmtiles),"map"in s&&o(2,n=s.map),"outputMetadata"in s&&o(0,l=s.outputMetadata)},a.$$.update=()=>{a.$$.dirty&2&&(t?p(t):r(F))},[l,t,n]}class Me extends ae{constructor(e){super(),ie(this,e,$e,null,J,{pmtiles:1,map:2,outputMetadata:0})}}function Ce(a){let e,o,t;return o=new me({props:{app:"main"}}),{c(){e=m("div"),B(o.$$.fragment),D(e,"slot","top")},m(n,l){C(n,e,l),I(o,e,null),t=!0},p:re,i(n){t||(g(o.$$.fragment,n),t=!0)},o(n){b(o.$$.fragment,n),t=!1},d(n){n&&S(e),H(o)}}}function ee(a){let e,o,t;return{c(){e=G("Open a "),o=m("i"),o.textContent=".pmtiles",t=G(`
          file produced by the tool. Note this file stays in your browser; it doesn't
          get uploaded anywhere.`)},m(n,l){C(n,e,l),C(n,o,l),C(n,t,l)},d(n){n&&(S(e),S(o),S(t))}}}function te(a){let e,o,t;function n(i){a[12](i)}let l={outputMetadata:a[3],map:a[1]};return a[4]!==void 0&&(l.controls=a[4]),e=new Ae({props:l}),Z.push(()=>T(e,"controls",n)),{c(){B(e.$$.fragment)},m(i,p){I(e,i,p),t=!0},p(i,p){const r={};p&8&&(r.outputMetadata=i[3]),p&2&&(r.map=i[1]),!o&&p&16&&(o=!0,r.controls=i[4],V(()=>o=!1)),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function Se(a){let e,o,t,n,l,i,p,r,s,f,u,w,k,$,M,_,A,L,Q,E,R,j,N,q,K,h=a[2]==null&&ee(),d=a[3]&&te(a);return{c(){e=m("div"),o=m("details"),t=m("summary"),t.textContent="Load a file",n=P(),l=m("label"),h&&h.c(),i=P(),p=m("input"),r=P(),s=m("label"),f=G(`Or load an example:
        `),u=m("select"),w=m("option"),w.textContent="Custom file loaded",k=m("option"),k.textContent="Edinburgh",$=m("option"),$.textContent=`England (2011 home-to-work)
          `,M=m("option"),M.textContent="Liverpool (direct)",_=m("option"),_.textContent="Liverpool (quiet)",A=m("option"),A.textContent="London",L=m("option"),L.textContent="Seattle",Q=m("option"),Q.textContent="York",E=m("option"),E.textContent="Lisbon",j=P(),d&&d.c(),D(t,"role","button"),D(t,"class","secondary"),D(p,"type","file"),w.__value="",y(w,w.__value),k.__value="edinburgh",y(k,k.__value),$.__value="england_2011_home_to_work",y($,$.__value),M.__value="liverpool_direct",y(M,M.__value),_.__value="liverpool_quiet",y(_,_.__value),A.__value="london",y(A,A.__value),L.__value="seattle",y(L,L.__value),Q.__value="york",y(Q,Q.__value),E.__value="lisbon",y(E,E.__value),a[0]===void 0&&_e(()=>a[11].call(u)),o.open=R=!a[3],D(e,"slot","left")},m(v,O){C(v,e,O),c(e,o),c(o,t),c(o,n),c(o,l),h&&h.m(l,null),c(l,i),c(l,p),a[10](p),c(o,r),c(o,s),c(s,f),c(s,u),c(u,w),c(u,k),c(u,$),c(u,M),c(u,_),c(u,A),c(u,L),c(u,Q),c(u,E),X(u,a[0],!0),c(e,j),d&&d.m(e,null),N=!0,q||(K=[W(p,"change",a[6]),W(u,"change",a[11])],q=!0)},p(v,O){v[2]==null?h||(h=ee(),h.c(),h.m(l,i)):h&&(h.d(1),h=null),O&1&&X(u,v[0]),(!N||O&8&&R!==(R=!v[3]))&&(o.open=R),v[3]?d?(d.p(v,O),O&8&&g(d,1)):(d=te(v),d.c(),g(d,1),d.m(e,null)):d&&(U(),b(d,1,1,()=>{d=null}),Y())},i(v){N||(g(d),N=!0)},o(v){b(d),N=!1},d(v){v&&S(e),h&&h.d(),a[10](null),d&&d.d(),q=!1,de(K)}}}function oe(a){let e=a[3],o,t,n=ne(a);return{c(){n.c(),o=se()},m(l,i){n.m(l,i),C(l,o,i),t=!0},p(l,i){i&8&&J(e,e=l[3])?(U(),b(n,1,1,re),Y(),n=ne(l),n.c(),g(n,1),n.m(o.parentNode,o)):n.p(l,i)},i(l){t||(g(n),t=!0)},o(l){b(n),t=!1},d(l){l&&S(o),n.d(l)}}}function ne(a){let e,o;return e=new ye({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:a[4]}}),{c(){B(e.$$.fragment)},m(t,n){I(e,t,n),o=!0},p(t,n){const l={};n&16&&(l.controls=t[4]),e.$set(l)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){H(e,t)}}}function Le(a){let e,o,t=a[3]&&oe(a);return{c(){t&&t.c(),e=se()},m(n,l){t&&t.m(n,l),C(n,e,l),o=!0},p(n,l){n[3]?t?(t.p(n,l),l&8&&g(t,1)):(t=oe(n),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(U(),b(t,1,1,()=>{t=null}),Y())},i(n){o||(g(t),o=!0)},o(n){b(t),o=!1},d(n){n&&S(e),t&&t.d(n)}}}function le(a){let e,o,t;function n(i){a[9](i)}let l={map:a[1],pmtiles:a[2]};return a[3]!==void 0&&(l.outputMetadata=a[3]),e=new Me({props:l}),Z.push(()=>T(e,"outputMetadata",n)),{c(){B(e.$$.fragment)},m(i,p){I(e,i,p),t=!0},p(i,p){const r={};p&2&&(r.map=i[1]),p&4&&(r.pmtiles=i[2]),!o&&p&8&&(o=!0,r.outputMetadata=i[3],V(()=>o=!1)),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function Qe(a){let e,o,t,n,l;function i(s){a[7](s)}let p={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,images:[{id:"chevron",url:we}],$$slots:{default:[Le]},$$scope:{ctx:a}};a[1]!==void 0&&(p.map=a[1]),o=new ge({props:p}),Z.push(()=>T(o,"map",i)),o.$on("error",a[8]);let r=a[1]&&le(a);return{c(){e=m("div"),B(o.$$.fragment),n=P(),r&&r.c(),D(e,"slot","main"),z(e,"position","relative"),z(e,"width","100%"),z(e,"height","100%")},m(s,f){C(s,e,f),I(o,e,null),c(e,n),r&&r.m(e,null),l=!0},p(s,f){const u={};f&8216&&(u.$$scope={dirty:f,ctx:s}),!t&&f&2&&(t=!0,u.map=s[1],V(()=>t=!1)),o.$set(u),s[1]?r?(r.p(s,f),f&2&&g(r,1)):(r=le(s),r.c(),g(r,1),r.m(e,null)):r&&(U(),b(r,1,1,()=>{r=null}),Y())},i(s){l||(g(o.$$.fragment,s),g(r),l=!0)},o(s){b(o.$$.fragment,s),b(r),l=!1},d(s){s&&S(e),H(o),r&&r.d()}}}function Ee(a){let e,o;return e=new fe({props:{$$slots:{main:[Qe],left:[Se],top:[Ce]},$$scope:{ctx:a}}}),{c(){B(e.$$.fragment)},m(t,n){I(e,t,n),o=!0},p(t,[n]){const l={};n&8255&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){H(e,t)}}}function Oe(a,e,o){ce(async()=>{await be()});let t,n,l="",i,p={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},r;function s(_){try{o(0,l="");let A=r.files;o(2,n=new x(new he(A[0])))}catch(A){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${A}`)}}function f(_){t=_,o(1,t)}const u=_=>console.log(_.detail);function w(_){i=_,o(3,i)}function k(_){Z[_?"unshift":"push"](()=>{r=_,o(5,r)})}function $(){l=ve(this),o(0,l)}function M(_){p=_,o(4,p)}return a.$$.update=()=>{a.$$.dirty&1&&l!=""&&o(2,n=new x(`https://assets.od2net.org/output/${l}.pmtiles`))},[l,t,n,i,p,r,s,f,u,w,k,$,M]}class De extends ae{constructor(e){super(),ie(this,e,Oe,Ee,J,{})}}new De({target:document.getElementById("app")});
