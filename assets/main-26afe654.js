import{S as oe,i as ne,s as z,m as ie,P as re,L as se,c as Q,a as E,t as g,b,d as O,o as ue,H as pe,e as d,f as H,g as C,n as le,h as S,j as I,k as q,l as w,p as fe,q as f,r as V,u as j,v as N,w as P,x as ce,M as me,y as R,z as F,A as Y,B as G,_ as _e,C as K,F as de,D as ge,E as ae}from"./Layout-af65b6e0.js";import{S as be,L as he}from"./SidebarControls-dca6fc95.js";const ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAm0lEQVRIS+2U0Q2AIAxEYQM30Q3UDXQy3UhHkE0cweuHHxKTXpuQaALJ/cE9eoXGUHjFwv6hAtSEPxFRh2su0Ayd6pWzDUwFO8700AGNVggDaGAqkNYDYQBStBvCAtwQC8AF8QA2kORlJWjQmm4BSB9M5lIyC3CZswC3OQu4PxqVef7TmYikoSs0aQ19GyMMwDp+HvsrQI3v/xFduXoiGbi1DtQAAAAASUVORK5CYII=";let Z="pmtilesSource";async function Ae(l){let e=await l.getHeader(),o=await l.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(o.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function we(l,e,o){let{pmtiles:t}=e,{map:n}=e,{outputMetadata:a=null}=e,r=new re;ie.addProtocol("pmtiles",r.tile);async function u(i){s(Z),r.add(i);let p=await Ae(i);n.addSource(Z,{type:"vector",tiles:["pmtiles://"+i.source.getKey()+"/{z}/{x}/{y}"],minzoom:p.minZoom,maxzoom:p.maxZoom,bounds:p.bounds}),n.fitBounds(p.bounds,{padding:100,duration:500}),o(0,a=p.outputMetadata)}function s(i){if(n.getSource(i)){let p=[];for(let c of n.getStyle().layers)"source"in c&&c.source==i&&p.push(c.id);for(let c of p)n.removeLayer(c);n.removeSource(i)}}return l.$$set=i=>{"pmtiles"in i&&o(1,t=i.pmtiles),"map"in i&&o(2,n=i.map),"outputMetadata"in i&&o(0,a=i.outputMetadata)},l.$$.update=()=>{l.$$.dirty&2&&(t?u(t):s(Z))},[a,t,n]}class ye extends oe{constructor(e){super(),ne(this,e,we,null,z,{pmtiles:1,map:2,outputMetadata:0})}}function ke(l){let e,o,t;return o=new pe({props:{app:"main"}}),{c(){e=d("div"),Q(o.$$.fragment),H(e,"slot","top")},m(n,a){C(n,e,a),E(o,e,null),t=!0},p:le,i(n){t||(g(o.$$.fragment,n),t=!0)},o(n){b(o.$$.fragment,n),t=!1},d(n){n&&S(e),O(o)}}}function X(l){let e,o,t;return{c(){e=q("Open a "),o=d("i"),o.textContent=".pmtiles",t=q(`
        file produced by the tool. Note this file stays in your browser; it doesn't
        get uploaded anywhere.`)},m(n,a){C(n,e,a),C(n,o,a),C(n,t,a)},d(n){n&&(S(e),S(o),S(t))}}}function W(l){let e,o,t;function n(r){l[12](r)}let a={outputMetadata:l[3],map:l[1]};return l[4]!==void 0&&(a.controls=l[4]),e=new be({props:a}),R.push(()=>F(e,"controls",n)),{c(){Q(e.$$.fragment)},m(r,u){E(e,r,u),t=!0},p(r,u){const s={};u&8&&(s.outputMetadata=r[3]),u&2&&(s.map=r[1]),!o&&u&16&&(o=!0,s.controls=r[4],G(()=>o=!1)),e.$set(s)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){O(e,r)}}}function $e(l){let e,o,t,n,a,r,u,s,i,p,c,y,k,$,M,m,A,L,J,B,U,T,h=l[2]==null&&X(),_=l[3]&&W(l);return{c(){e=d("div"),o=d("label"),h&&h.c(),t=I(),n=d("input"),a=I(),r=d("div"),u=d("label"),s=q(`Or load an example:
        `),i=d("select"),p=d("option"),p.textContent="Custom file loaded",c=d("option"),c.textContent="Edinburgh",y=d("option"),y.textContent=`England (2011 home-to-work)
          `,k=d("option"),k.textContent="Liverpool (direct)",$=d("option"),$.textContent="Liverpool (quiet)",M=d("option"),M.textContent="London",m=d("option"),m.textContent="Seattle",A=d("option"),A.textContent="York",L=d("option"),L.textContent="Lisbon",J=I(),_&&_.c(),H(n,"type","file"),p.__value="",w(p,p.__value),c.__value="edinburgh",w(c,c.__value),y.__value="england_2011_home_to_work",w(y,y.__value),k.__value="liverpool_direct",w(k,k.__value),$.__value="liverpool_quiet",w($,$.__value),M.__value="london",w(M,M.__value),m.__value="seattle",w(m,m.__value),A.__value="york",w(A,A.__value),L.__value="lisbon",w(L,L.__value),l[0]===void 0&&fe(()=>l[11].call(i)),H(e,"slot","left")},m(v,D){C(v,e,D),f(e,o),h&&h.m(o,null),f(o,t),f(o,n),l[10](n),f(e,a),f(e,r),f(r,u),f(u,s),f(u,i),f(i,p),f(i,c),f(i,y),f(i,k),f(i,$),f(i,M),f(i,m),f(i,A),f(i,L),V(i,l[0],!0),f(e,J),_&&_.m(e,null),B=!0,U||(T=[j(n,"change",l[6]),j(i,"change",l[11])],U=!0)},p(v,D){v[2]==null?h||(h=X(),h.c(),h.m(o,t)):h&&(h.d(1),h=null),D&1&&V(i,v[0]),v[3]?_?(_.p(v,D),D&8&&g(_,1)):(_=W(v),_.c(),g(_,1),_.m(e,null)):_&&(N(),b(_,1,1,()=>{_=null}),P())},i(v){B||(g(_),B=!0)},o(v){b(_),B=!1},d(v){v&&S(e),h&&h.d(),l[10](null),_&&_.d(),U=!1,ce(T)}}}function x(l){let e=l[3],o,t,n=ee(l);return{c(){n.c(),o=ae()},m(a,r){n.m(a,r),C(a,o,r),t=!0},p(a,r){r&8&&z(e,e=a[3])?(N(),b(n,1,1,le),P(),n=ee(a),n.c(),g(n,1),n.m(o.parentNode,o)):n.p(a,r)},i(a){t||(g(n),t=!0)},o(a){b(n),t=!1},d(a){a&&S(o),n.d(a)}}}function ee(l){let e,o;return e=new he({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:l[4]}}),{c(){Q(e.$$.fragment)},m(t,n){E(e,t,n),o=!0},p(t,n){const a={};n&16&&(a.controls=t[4]),e.$set(a)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){O(e,t)}}}function Me(l){let e,o,t=l[3]&&x(l);return{c(){t&&t.c(),e=ae()},m(n,a){t&&t.m(n,a),C(n,e,a),o=!0},p(n,a){n[3]?t?(t.p(n,a),a&8&&g(t,1)):(t=x(n),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(N(),b(t,1,1,()=>{t=null}),P())},i(n){o||(g(t),o=!0)},o(n){b(t),o=!1},d(n){n&&S(e),t&&t.d(n)}}}function te(l){let e,o,t;function n(r){l[9](r)}let a={map:l[1],pmtiles:l[2]};return l[3]!==void 0&&(a.outputMetadata=l[3]),e=new ye({props:a}),R.push(()=>F(e,"outputMetadata",n)),{c(){Q(e.$$.fragment)},m(r,u){E(e,r,u),t=!0},p(r,u){const s={};u&2&&(s.map=r[1]),u&4&&(s.pmtiles=r[2]),!o&&u&8&&(o=!0,s.outputMetadata=r[3],G(()=>o=!1)),e.$set(s)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){O(e,r)}}}function Ce(l){let e,o,t,n,a;function r(i){l[7](i)}let u={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,images:[{id:"chevron",url:ve}],$$slots:{default:[Me]},$$scope:{ctx:l}};l[1]!==void 0&&(u.map=l[1]),o=new me({props:u}),R.push(()=>F(o,"map",r)),o.$on("error",l[8]);let s=l[1]&&te(l);return{c(){e=d("div"),Q(o.$$.fragment),n=I(),s&&s.c(),H(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100%")},m(i,p){C(i,e,p),E(o,e,null),f(e,n),s&&s.m(e,null),a=!0},p(i,p){const c={};p&8216&&(c.$$scope={dirty:p,ctx:i}),!t&&p&2&&(t=!0,c.map=i[1],G(()=>t=!1)),o.$set(c),i[1]?s?(s.p(i,p),p&2&&g(s,1)):(s=te(i),s.c(),g(s,1),s.m(e,null)):s&&(N(),b(s,1,1,()=>{s=null}),P())},i(i){a||(g(o.$$.fragment,i),g(s),a=!0)},o(i){b(o.$$.fragment,i),b(s),a=!1},d(i){i&&S(e),O(o),s&&s.d()}}}function Se(l){let e,o;return e=new se({props:{$$slots:{main:[Ce],left:[$e],top:[ke]},$$scope:{ctx:l}}}),{c(){Q(e.$$.fragment)},m(t,n){E(e,t,n),o=!0},p(t,[n]){const a={};n&8255&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){O(e,t)}}}function Le(l,e,o){ue(async()=>{await _e()});let t,n,a="",r,u={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},s;function i(m){try{o(0,a="");let A=s.files;o(2,n=new K(new de(A[0])))}catch(A){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${A}`)}}function p(m){t=m,o(1,t)}const c=m=>console.log(m.detail);function y(m){r=m,o(3,r)}function k(m){R[m?"unshift":"push"](()=>{s=m,o(5,s)})}function $(){a=ge(this),o(0,a)}function M(m){u=m,o(4,u)}return l.$$.update=()=>{l.$$.dirty&1&&a!=""&&o(2,n=new K(`https://assets.od2net.org/output/${a}.pmtiles`))},[a,t,n,r,u,s,i,p,c,y,k,$,M]}class Qe extends oe{constructor(e){super(),ne(this,e,Le,Se,z,{})}}new Qe({target:document.getElementById("app")});
