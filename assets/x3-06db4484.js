import{S as ue,i as ce,s as _e,L as me,c as N,f as j,a as O,l as S,t as w,b as C,v,d as B,o as de,H as $e,x as V,y as ne,e as h,g as z,h as K,n as $,q as ee,A as se,r as fe,u as pe,M as ge,z as Z,_ as be,a1 as he,a5 as J,a6 as le,C as we,W as ke,j as x,k as ye,p as oe,w as Ce,ag as te,a2 as Le,af as Se,ad as ve,ae as D,a4 as Fe,a9 as Me,aa as Ne}from"./SequentialLegend-e4b1108f.js";import{L as Oe,C as Be,O as Ee,_ as je,J as qe,a as Te,G as Je}from"./OverpassSelector-230d3c90.js";function ae(s){let e,n;return{c(){e=h("p"),n=z(s[12])},m(t,l){S(t,e,l),$(e,n)},p(t,l){l&4096&&ke(n,t[12])},d(t){t&&v(e)}}}function re(s){let e,n,t,l,o,r,i,c,k,y,g,b,m,E,q,L,A,P,G,H,p,_,u,F,I;const R=[Ae,Pe],T=[];function W(f,a){return f[5]=="lts"?0:1}g=W(s),b=T[g]=R[g](s);function Y(f){s[24](f)}let U={};return s[1]!==void 0&&(U.cost=s[1]),p=new Te({props:U}),V.push(()=>ne(p,"cost",Y)),{c(){e=h("hr"),n=j(),t=h("div"),l=h("label"),o=z(`Color edges by:
          `),r=h("select"),i=h("option"),i.textContent="LTS",c=h("option"),c.textContent="Edge cost (relative to length)",k=h("option"),k.textContent="Nearby amenities",y=j(),b.c(),m=j(),E=h("div"),q=h("label"),L=h("input"),A=z(`
          Show cyclists not allowed`),P=j(),G=h("hr"),H=j(),N(p.$$.fragment),i.__value="lts",x(i,i.__value),c.__value="cost",x(c,c.__value),k.__value="nearby_amenities",x(k,k.__value),s[5]===void 0&&ye(()=>s[22].call(r)),K(L,"type","checkbox"),Z(q,"color",J.lts_not_allowed)},m(f,a){S(f,e,a),S(f,n,a),S(f,t,a),$(t,l),$(l,o),$(l,r),$(r,i),$(r,c),$(r,k),oe(r,s[5],!0),S(f,y,a),T[g].m(f,a),S(f,m,a),S(f,E,a),$(E,q),$(q,L),L.checked=s[6],$(q,A),S(f,P,a),S(f,G,a),S(f,H,a),O(p,f,a),u=!0,F||(I=[ee(r,"change",s[22]),ee(L,"change",s[23])],F=!0)},p(f,a){a&32&&oe(r,f[5]);let d=g;g=W(f),g===d?T[g].p(f,a):(fe(),C(T[d],1,1,()=>{T[d]=null}),pe(),b=T[g],b?b.p(f,a):(b=T[g]=R[g](f),b.c()),w(b,1),b.m(m.parentNode,m)),a&64&&(L.checked=f[6]);const M={};!_&&a&2&&(_=!0,M.cost=f[1],se(()=>_=!1)),p.$set(M)},i(f){u||(w(b),w(p.$$.fragment,f),u=!0)},o(f){C(b),C(p.$$.fragment,f),u=!1},d(f){f&&(v(e),v(n),v(t),v(y),v(m),v(E),v(P),v(G),v(H)),T[g].d(f),B(p,f),F=!1,Ce(I)}}}function Pe(s){let e,n;return e=new Se({props:{colorScale:te,limits:Q(s[5],s[9],s[10])}}),{c(){N(e.$$.fragment)},m(t,l){O(e,t,l),n=!0},p(t,l){const o={};l&1568&&(o.limits=Q(t[5],t[9],t[10])),e.$set(o)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ae(s){let e,n,t,l;return e=new ve({props:{rows:[[`${D.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,J.lts1],[`${D.lts2}: ${s[8][2].toFixed(0)}%`,J.lts2],[`${D.lts3}: ${s[8][3].toFixed(0)}%`,J.lts3],[`${D.lts4}: ${s[8][4].toFixed(0)}%`,J.lts4]]}}),{c(){N(e.$$.fragment),n=j(),t=h("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(o,r){O(e,o,r),S(o,n,r),S(o,t,r),l=!0},p(o,r){const i={};r&256&&(i.rows=[[`${D.lts1}: ${o[8][1].toFixed(0)}% of roads by distance`,J.lts1],[`${D.lts2}: ${o[8][2].toFixed(0)}%`,J.lts2],[`${D.lts3}: ${o[8][3].toFixed(0)}%`,J.lts3],[`${D.lts4}: ${o[8][4].toFixed(0)}%`,J.lts4]]),e.$set(i)},i(o){l||(w(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){o&&(v(n),v(t)),B(e,o)}}}function He(s){let e,n,t,l,o,r,i,c,k,y,g,b,m,E,q,L,A,P;n=new $e({props:{app:"costs"}});function G(u){s[19](u)}let H={};s[0]!==void 0&&(H.example=s[0]),y=new Be({props:H}),V.push(()=>ne(y,"example",G)),m=new Ee({props:{map:s[2]}}),m.$on("gotXml",s[16]),m.$on("loading",s[20]),m.$on("error",s[21]);let p=s[12]&&ae(s),_=s[3]&&re(s);return{c(){e=h("div"),N(n.$$.fragment),t=j(),l=h("label"),o=z("Open an "),r=h("i"),r.textContent=".osm.pbf",i=z(`
      file
      `),c=h("input"),k=j(),N(y.$$.fragment),b=j(),N(m.$$.fragment),E=j(),p&&p.c(),q=j(),_&&_.c(),K(c,"type","file"),K(e,"slot","left")},m(u,F){S(u,e,F),O(n,e,null),$(e,t),$(e,l),$(l,o),$(l,r),$(l,i),$(l,c),s[18](c),$(e,k),O(y,e,null),$(e,b),O(m,e,null),$(e,E),p&&p.m(e,null),$(e,q),_&&_.m(e,null),L=!0,A||(P=ee(c,"change",s[13]),A=!0)},p(u,F){const I={};!g&&F&1&&(g=!0,I.example=u[0],se(()=>g=!1)),y.$set(I);const R={};F&4&&(R.map=u[2]),m.$set(R),u[12]?p?p.p(u,F):(p=ae(u),p.c(),p.m(e,q)):p&&(p.d(1),p=null),u[3]?_?(_.p(u,F),F&8&&w(_,1)):(_=re(u),_.c(),w(_,1),_.m(e,null)):_&&(fe(),C(_,1,1,()=>{_=null}),pe())},i(u){L||(w(n.$$.fragment,u),w(y.$$.fragment,u),w(m.$$.fragment,u),w(_),L=!0)},o(u){C(n.$$.fragment,u),C(y.$$.fragment,u),C(m.$$.fragment,u),C(_),L=!1},d(u){u&&v(e),B(n),s[18](null),B(y),B(m),p&&p.d(),_&&_.d(),A=!1,P()}}}function De(s){let e,n;return e=new Ne({props:{properties:s[29]}}),{c(){N(e.$$.fragment)},m(t,l){O(e,t,l),n=!0},p(t,l){const o={};l&536870912&&(o.properties=t[29]),e.$set(o)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ge(s){let e,n;return e=new Me({props:{$$slots:{default:[De,({props:t})=>({29:t}),({props:t})=>t?536870912:0]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,l){O(e,t,l),n=!0},p(t,l){const o={};l&1610612736&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ie(s){let e,n;return e=new Fe({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":s[14](s[5],s[9],s[10]),"line-opacity":s[15](s[5],s[6])},beforeId:"Road labels",$$slots:{default:[Ge]},$$scope:{ctx:s}}}),e.$on("click",We),{c(){N(e.$$.fragment)},m(t,l){O(e,t,l),n=!0},p(t,l){const o={};l&1632&&(o.paint={"line-width":5,"line-color":t[14](t[5],t[9],t[10]),"line-opacity":t[15](t[5],t[6])}),l&1073741824&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Re(s){let e,n;return e=new Je({props:{data:s[4],$$slots:{default:[Ie]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,l){O(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.data=t[4]),l&1073743456&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Xe(s){let e,n,t,l;function o(i){s[17](i)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Re]},$$scope:{ctx:s}};return s[2]!==void 0&&(r.map=s[2]),n=new ge({props:r}),V.push(()=>ne(n,"map",o)),{c(){e=h("div"),N(n.$$.fragment),K(e,"slot","main"),Z(e,"position","relative"),Z(e,"width","100%"),Z(e,"height","100vh")},m(i,c){S(i,e,c),O(n,e,null),l=!0},p(i,c){const k={};c&1073743472&&(k.$$scope={dirty:c,ctx:i}),!t&&c&4&&(t=!0,k.map=i[2],se(()=>t=!1)),n.$set(k)},i(i){l||(w(n.$$.fragment,i),l=!0)},o(i){C(n.$$.fragment,i),l=!1},d(i){i&&v(e),B(n)}}}function ze(s){let e,n,t,l;return e=new me({props:{$$slots:{main:[Xe],left:[He]},$$scope:{ctx:s}}}),t=new Oe({props:{loading:s[7]}}),{c(){N(e.$$.fragment),n=j(),N(t.$$.fragment)},m(o,r){O(e,o,r),S(o,n,r),O(t,o,r),l=!0},p(o,[r]){const i={};r&1073749887&&(i.$$scope={dirty:r,ctx:o}),e.$set(i);const c={};r&128&&(c.loading=o[7]),t.$set(c)},i(o){l||(w(e.$$.fragment,o),w(t.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),C(t.$$.fragment,o),l=!1},d(o){o&&v(n),B(e,o),B(t,o)}}}function We(s){let e=s.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function Q(s,e,n){if(s=="lts")return[];if(s=="cost")return ie(0,e);if(s=="nearby_amenities")return ie(0,n);throw new Error("unreachable")}function ie(s,e){let n=[],t=(e-s)/5;for(let l=0;l<6;l++)n.push(s+l*t);return n}function Ue(s,e,n){de(async()=>{await je(),await be()});let t,l,o="",r={type:"FeatureCollection",features:[]},i="Distance",c="cost",k=!1,y=!1,g=[0,0,0,0,0],b=1,m=1,E;async function q(a){n(0,o=""),n(7,y=!0),L(await E.files[0].arrayBuffer())}function L(a){try{n(3,l=new qe(new Uint8Array(a))),n(1,i="Distance");let d=l.getBounds();t.fitBounds([[d[0],d[1]],[d[2],d[3]]],{padding:20,animate:!1}),P()}catch(d){window.alert(`Problem importing osm.pbf file: ${d}`)}n(7,y=!1)}async function A(a){if(a!=""){n(7,y=!0);let d=await fetch(`https://assets.od2net.org/pbf_clips/${a}.osm.pbf`);L(await d.arrayBuffer())}}function P(){n(4,r=JSON.parse(l.debugNetwork()));let a=0,d=[0,0,0,0,0];n(9,b=0),n(10,m=0);for(let M of r.features){let X=M.properties;n(10,m=Math.max(m,X.nearby_amenities)),X.length&&(n(9,b=Math.max(b,X.forward_cost/X.length)),a+=X.length,d[X.lts]+=X.length)}n(8,g=d.map(M=>M/a*100))}function G(a,d,M){if(a=="lts")return he;if(a=="cost")return["case",["==",0,["get","lts"]],J.lts_not_allowed,le(["/",["get","forward_cost"],["get","length"]],Q(a,d,M),te)];if(a=="nearby_amenities")return le(["get","nearby_amenities"],Q(a,d,M),te);throw new Error("unreachable")}function H(a,d){let M=Le(1,.5);return a=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,M]:d?M:["case",["==",0,["get","lts"]],0,M]}let p="";function _(a){n(12,p="Parsing XML"),L(new TextEncoder().encode(a.detail)),n(12,p="")}function u(a){l&&(l.updateCostFunction(a),P())}function F(a){t=a,n(2,t)}function I(a){V[a?"unshift":"push"](()=>{E=a,n(11,E)})}function R(a){o=a,n(0,o)}const T=a=>n(12,p=a.detail),W=a=>n(12,p=a.detail);function Y(){c=we(this),n(5,c)}function U(){k=this.checked,n(6,k)}function f(a){i=a,n(1,i)}return s.$$.update=()=>{s.$$.dirty&1&&A(o),s.$$.dirty&2&&u(i)},[o,i,t,l,r,c,k,y,g,b,m,E,p,q,G,H,_,F,I,R,T,W,Y,U,f]}class Ze extends ue{constructor(e){super(),ce(this,e,Ue,ze,_e,{})}}new Ze({target:document.getElementById("app")});
