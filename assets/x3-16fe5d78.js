import{S as ue,i as _e,s as me,L as ce,c as F,f as E,a as M,l as L,t as h,b as k,v as S,d as N,o as de,H as $e,x as V,y as ne,e as w,g as z,h as K,n as $,q as ee,A as se,r as fe,u as pe,M as ge,z as Z,_ as be,a1 as he,a5 as T,a7 as le,C as we,W as ke,j as x,k as ye,p as oe,w as Ce,ah as te,a2 as Le,ag as Se,ae as ve,af as D,a4 as Fe,aa as Me,ab as Ne}from"./SequentialLegend-89cac39e.js";import{L as Oe,C as Be,O as Ee,_ as je,J as qe,a as Pe,G as Te,P as Je}from"./OverpassSelector-70737ec4.js";function re(l){let e,n;return{c(){e=w("p"),n=z(l[12])},m(t,o){L(t,e,o),$(e,n)},p(t,o){o&4096&&ke(n,t[12])},d(t){t&&S(e)}}}function ae(l){let e,n,t,o,s,a,i,_,y,C,g,b,c,j,q,v,A,J,G,H,p,m,u,O,I;const R=[He,Ae],P=[];function W(f,r){return f[5]=="lts"?0:1}g=W(l),b=P[g]=R[g](l);function Y(f){l[24](f)}let U={};return l[1]!==void 0&&(U.cost=l[1]),p=new Pe({props:U}),V.push(()=>ne(p,"cost",Y)),{c(){e=w("hr"),n=E(),t=w("div"),o=w("label"),s=z(`Color edges by:
          `),a=w("select"),i=w("option"),i.textContent="LTS",_=w("option"),_.textContent="Edge cost (relative to length)",y=w("option"),y.textContent="Nearby amenities",C=E(),b.c(),c=E(),j=w("div"),q=w("label"),v=w("input"),A=z(`
          Show cyclists not allowed`),J=E(),G=w("hr"),H=E(),F(p.$$.fragment),i.__value="lts",x(i,i.__value),_.__value="cost",x(_,_.__value),y.__value="nearby_amenities",x(y,y.__value),l[5]===void 0&&ye(()=>l[22].call(a)),K(v,"type","checkbox"),Z(q,"color",T.lts_not_allowed)},m(f,r){L(f,e,r),L(f,n,r),L(f,t,r),$(t,o),$(o,s),$(o,a),$(a,i),$(a,_),$(a,y),oe(a,l[5],!0),L(f,C,r),P[g].m(f,r),L(f,c,r),L(f,j,r),$(j,q),$(q,v),v.checked=l[6],$(q,A),L(f,J,r),L(f,G,r),L(f,H,r),M(p,f,r),u=!0,O||(I=[ee(a,"change",l[22]),ee(v,"change",l[23])],O=!0)},p(f,r){r&32&&oe(a,f[5]);let d=g;g=W(f),g===d?P[g].p(f,r):(fe(),k(P[d],1,1,()=>{P[d]=null}),pe(),b=P[g],b?b.p(f,r):(b=P[g]=R[g](f),b.c()),h(b,1),b.m(c.parentNode,c)),r&64&&(v.checked=f[6]);const B={};!m&&r&2&&(m=!0,B.cost=f[1],se(()=>m=!1)),p.$set(B)},i(f){u||(h(b),h(p.$$.fragment,f),u=!0)},o(f){k(b),k(p.$$.fragment,f),u=!1},d(f){f&&(S(e),S(n),S(t),S(C),S(c),S(j),S(J),S(G),S(H)),P[g].d(f),N(p,f),O=!1,Ce(I)}}}function Ae(l){let e,n;return e=new Se({props:{colorScale:te,limits:Q(l[5],l[9],l[10])}}),{c(){F(e.$$.fragment)},m(t,o){M(e,t,o),n=!0},p(t,o){const s={};o&1568&&(s.limits=Q(t[5],t[9],t[10])),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function He(l){let e,n,t,o;return e=new ve({props:{rows:[[`${D.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,T.lts1],[`${D.lts2}: ${l[8][2].toFixed(0)}%`,T.lts2],[`${D.lts3}: ${l[8][3].toFixed(0)}%`,T.lts3],[`${D.lts4}: ${l[8][4].toFixed(0)}%`,T.lts4]]}}),{c(){F(e.$$.fragment),n=E(),t=w("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,a){M(e,s,a),L(s,n,a),L(s,t,a),o=!0},p(s,a){const i={};a&256&&(i.rows=[[`${D.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,T.lts1],[`${D.lts2}: ${s[8][2].toFixed(0)}%`,T.lts2],[`${D.lts3}: ${s[8][3].toFixed(0)}%`,T.lts3],[`${D.lts4}: ${s[8][4].toFixed(0)}%`,T.lts4]]),e.$set(i)},i(s){o||(h(e.$$.fragment,s),o=!0)},o(s){k(e.$$.fragment,s),o=!1},d(s){s&&(S(n),S(t)),N(e,s)}}}function De(l){let e,n,t,o,s,a,i,_,y,C,g,b,c,j,q,v,A,J;n=new $e({props:{app:"costs"}});function G(u){l[19](u)}let H={};l[0]!==void 0&&(H.example=l[0]),C=new Be({props:H}),V.push(()=>ne(C,"example",G)),c=new Ee({props:{map:l[2]}}),c.$on("gotXml",l[16]),c.$on("loading",l[20]),c.$on("error",l[21]);let p=l[12]&&re(l),m=l[3]&&ae(l);return{c(){e=w("div"),F(n.$$.fragment),t=E(),o=w("label"),s=z("Open an "),a=w("i"),a.textContent=".osm.pbf",i=z(`
      file
      `),_=w("input"),y=E(),F(C.$$.fragment),b=E(),F(c.$$.fragment),j=E(),p&&p.c(),q=E(),m&&m.c(),K(_,"type","file"),K(e,"slot","left")},m(u,O){L(u,e,O),M(n,e,null),$(e,t),$(e,o),$(o,s),$(o,a),$(o,i),$(o,_),l[18](_),$(e,y),M(C,e,null),$(e,b),M(c,e,null),$(e,j),p&&p.m(e,null),$(e,q),m&&m.m(e,null),v=!0,A||(J=ee(_,"change",l[13]),A=!0)},p(u,O){const I={};!g&&O&1&&(g=!0,I.example=u[0],se(()=>g=!1)),C.$set(I);const R={};O&4&&(R.map=u[2]),c.$set(R),u[12]?p?p.p(u,O):(p=re(u),p.c(),p.m(e,q)):p&&(p.d(1),p=null),u[3]?m?(m.p(u,O),O&8&&h(m,1)):(m=ae(u),m.c(),h(m,1),m.m(e,null)):m&&(fe(),k(m,1,1,()=>{m=null}),pe())},i(u){v||(h(n.$$.fragment,u),h(C.$$.fragment,u),h(c.$$.fragment,u),h(m),v=!0)},o(u){k(n.$$.fragment,u),k(C.$$.fragment,u),k(c.$$.fragment,u),k(m),v=!1},d(u){u&&S(e),N(n),l[18](null),N(C),N(c),p&&p.d(),m&&m.d(),A=!1,J()}}}function Ge(l){let e,n;return e=new Ne({props:{properties:l[29]}}),{c(){F(e.$$.fragment)},m(t,o){M(e,t,o),n=!0},p(t,o){const s={};o&536870912&&(s.properties=t[29]),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Ie(l){let e,n;return e=new Me({props:{$$slots:{default:[Ge,({props:t})=>({29:t}),({props:t})=>t?536870912:0]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},m(t,o){M(e,t,o),n=!0},p(t,o){const s={};o&1610612736&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Re(l){let e,n;return e=new Fe({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[14](l[5],l[9],l[10]),"line-opacity":l[15](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[Ie]},$$scope:{ctx:l}}}),e.$on("click",Ue),{c(){F(e.$$.fragment)},m(t,o){M(e,t,o),n=!0},p(t,o){const s={};o&1632&&(s.paint={"line-width":5,"line-color":t[14](t[5],t[9],t[10]),"line-opacity":t[15](t[5],t[6])}),o&1073741824&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Xe(l){let e,n,t,o;return e=new Te({props:{data:l[4],$$slots:{default:[Re]},$$scope:{ctx:l}}}),t=new Je({}),{c(){F(e.$$.fragment),n=E(),F(t.$$.fragment)},m(s,a){M(e,s,a),L(s,n,a),M(t,s,a),o=!0},p(s,a){const i={};a&16&&(i.data=s[4]),a&1073743456&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){o||(h(e.$$.fragment,s),h(t.$$.fragment,s),o=!0)},o(s){k(e.$$.fragment,s),k(t.$$.fragment,s),o=!1},d(s){s&&S(n),N(e,s),N(t,s)}}}function ze(l){let e,n,t,o;function s(i){l[17](i)}let a={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Xe]},$$scope:{ctx:l}};return l[2]!==void 0&&(a.map=l[2]),n=new ge({props:a}),V.push(()=>ne(n,"map",s)),{c(){e=w("div"),F(n.$$.fragment),K(e,"slot","main"),Z(e,"position","relative"),Z(e,"width","100%"),Z(e,"height","100vh")},m(i,_){L(i,e,_),M(n,e,null),o=!0},p(i,_){const y={};_&1073743472&&(y.$$scope={dirty:_,ctx:i}),!t&&_&4&&(t=!0,y.map=i[2],se(()=>t=!1)),n.$set(y)},i(i){o||(h(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&S(e),N(n)}}}function We(l){let e,n,t,o;return e=new ce({props:{$$slots:{main:[ze],left:[De]},$$scope:{ctx:l}}}),t=new Oe({props:{loading:l[7]}}),{c(){F(e.$$.fragment),n=E(),F(t.$$.fragment)},m(s,a){M(e,s,a),L(s,n,a),M(t,s,a),o=!0},p(s,[a]){const i={};a&1073749887&&(i.$$scope={dirty:a,ctx:s}),e.$set(i);const _={};a&128&&(_.loading=s[7]),t.$set(_)},i(s){o||(h(e.$$.fragment,s),h(t.$$.fragment,s),o=!0)},o(s){k(e.$$.fragment,s),k(t.$$.fragment,s),o=!1},d(s){s&&S(n),N(e,s),N(t,s)}}}function Ue(l){let e=l.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function Q(l,e,n){if(l=="lts")return[];if(l=="cost")return ie(0,e);if(l=="nearby_amenities")return ie(0,n);throw new Error("unreachable")}function ie(l,e){let n=[],t=(e-l)/5;for(let o=0;o<6;o++)n.push(l+o*t);return n}function Ze(l,e,n){de(async()=>{await je(),await be()});let t,o,s="",a={type:"FeatureCollection",features:[]},i="Distance",_="cost",y=!1,C=!1,g=[0,0,0,0,0],b=1,c=1,j;async function q(r){n(0,s=""),n(7,C=!0),v(await j.files[0].arrayBuffer())}function v(r){try{n(3,o=new qe(new Uint8Array(r))),n(1,i="Distance");let d=o.getBounds();t.fitBounds([[d[0],d[1]],[d[2],d[3]]],{padding:20,animate:!1}),J()}catch(d){window.alert(`Problem importing osm.pbf file: ${d}`)}n(7,C=!1)}async function A(r){if(r!=""){n(7,C=!0);let d=await fetch(`https://assets.od2net.org/pbf_clips/${r}.osm.pbf`);v(await d.arrayBuffer())}}function J(){n(4,a=JSON.parse(o.debugNetwork()));let r=0,d=[0,0,0,0,0];n(9,b=0),n(10,c=0);for(let B of a.features){let X=B.properties;n(10,c=Math.max(c,X.nearby_amenities)),X.length&&(n(9,b=Math.max(b,X.forward_cost/X.length)),r+=X.length,d[X.lts]+=X.length)}n(8,g=d.map(B=>B/r*100))}function G(r,d,B){if(r=="lts")return he;if(r=="cost")return["case",["==",0,["get","lts"]],T.lts_not_allowed,le(["/",["get","forward_cost"],["get","length"]],Q(r,d,B),te)];if(r=="nearby_amenities")return le(["get","nearby_amenities"],Q(r,d,B),te);throw new Error("unreachable")}function H(r,d){let B=Le(1,.5);return r=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,B]:d?B:["case",["==",0,["get","lts"]],0,B]}let p="";function m(r){n(12,p="Parsing XML"),v(new TextEncoder().encode(r.detail)),n(12,p="")}function u(r){o&&(o.updateCostFunction(r),J())}function O(r){t=r,n(2,t)}function I(r){V[r?"unshift":"push"](()=>{j=r,n(11,j)})}function R(r){s=r,n(0,s)}const P=r=>n(12,p=r.detail),W=r=>n(12,p=r.detail);function Y(){_=we(this),n(5,_)}function U(){y=this.checked,n(6,y)}function f(r){i=r,n(1,i)}return l.$$.update=()=>{l.$$.dirty&1&&A(s),l.$$.dirty&2&&u(i)},[s,i,t,o,a,_,y,C,g,b,c,j,p,q,G,H,m,O,I,R,P,W,Y,U,f]}class Ke extends ue{constructor(e){super(),_e(this,e,Ze,We,me,{})}}new Ke({target:document.getElementById("app")});
