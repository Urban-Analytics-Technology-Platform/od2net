import{S as ce,i as _e,s as me,ai as se,e as _,f as I,g as h,q as m,n as x,h as w,aj as $e,k as R,j as B,ab as oe,L as be,c as C,a as S,t as y,b as k,d as F,o as he,H as we,y as Q,z as ne,u as ee,B as le,v as de,w as ge,M as ye,A as H,_ as ke,a2 as ve,a6 as T,a7 as re,D as Le,l as Y,p as Ce,r as ae,x as Se,ak as te,a3 as Fe,ah as Oe,af as je,ag as J,a5 as Be,aa as Ee}from"./Layout-af65b6e0.js";import{L as Me,C as Ne,O as Pe,_ as qe,J as Te,a as Ae,G as Je,P as De}from"./index-7c7636be.js";function ie(o,e,n){const t=o.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function fe(o){let e,n,t=o[1]+"",s,l,i,a=o[2]+"",f,$;return{c(){e=_("tr"),n=_("td"),s=R(t),l=B(),i=_("td"),f=R(a),$=B()},m(g,u){h(g,e,u),m(e,n),m(n,s),m(e,l),m(e,i),m(i,f),m(e,$)},p(g,u){u&1&&t!==(t=g[1]+"")&&oe(s,t),u&1&&a!==(a=g[2]+"")&&oe(f,a)},d(g){g&&w(e)}}}function He(o){let e,n,t=se(Object.entries(o[0])),s=[];for(let l=0;l<t.length;l+=1)s[l]=fe(ie(o,t,l));return{c(){e=_("table"),n=_("tbody");for(let l=0;l<s.length;l+=1)s[l].c();I(e,"class","svelte-lh2o9l")},m(l,i){h(l,e,i),m(e,n);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null)},p(l,[i]){if(i&1){t=se(Object.entries(l[0]));let a;for(a=0;a<t.length;a+=1){const f=ie(l,t,a);s[a]?s[a].p(f,i):(s[a]=fe(f),s[a].c(),s[a].m(n,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=t.length}},i:x,o:x,d(l){l&&w(e),$e(s,l)}}}function Ge(o,e,n){let{properties:t}=e;return o.$$set=s=>{"properties"in s&&n(0,t=s.properties)},[t]}class Ie extends ce{constructor(e){super(),_e(this,e,Ge,He,me,{properties:0})}}function Re(o){let e,n,t;return n=new we({props:{app:"costs"}}),{c(){e=_("div"),C(n.$$.fragment),I(e,"slot","top")},m(s,l){h(s,e,l),S(n,e,null),t=!0},p:x,i(s){t||(y(n.$$.fragment,s),t=!0)},o(s){k(n.$$.fragment,s),t=!1},d(s){s&&w(e),F(n)}}}function pe(o){let e,n,t,s,l,i,a,f,$,g,u,b,v,O,N,E,D,c,d,M,j,A,G,X,z;const U=[ze,Xe],P=[];function W(r,p){return r[5]=="lts"?0:1}u=W(o),b=P[u]=U[u](o);function V(r){o[23](r)}let Z={};return o[1]!==void 0&&(Z.cost=o[1]),j=new Ae({props:Z}),Q.push(()=>ne(j,"cost",V)),{c(){e=_("hr"),n=B(),t=_("div"),s=_("label"),l=R(`Color edges by:
          `),i=_("select"),a=_("option"),a.textContent="LTS",f=_("option"),f.textContent="Edge cost (relative to length)",$=_("option"),$.textContent="Nearby amenities",g=B(),b.c(),v=B(),O=_("div"),N=_("label"),E=_("input"),D=R(`
          Show cyclists not allowed`),c=B(),d=_("hr"),M=B(),C(j.$$.fragment),a.__value="lts",Y(a,a.__value),f.__value="cost",Y(f,f.__value),$.__value="nearby_amenities",Y($,$.__value),o[5]===void 0&&Ce(()=>o[21].call(i)),I(E,"type","checkbox"),H(N,"color",T.lts_not_allowed)},m(r,p){h(r,e,p),h(r,n,p),h(r,t,p),m(t,s),m(s,l),m(s,i),m(i,a),m(i,f),m(i,$),ae(i,o[5],!0),h(r,g,p),P[u].m(r,p),h(r,v,p),h(r,O,p),m(O,N),m(N,E),E.checked=o[6],m(N,D),h(r,c,p),h(r,d,p),h(r,M,p),S(j,r,p),G=!0,X||(z=[ee(i,"change",o[21]),ee(E,"change",o[22])],X=!0)},p(r,p){p&32&&ae(i,r[5]);let L=u;u=W(r),u===L?P[u].p(r,p):(de(),k(P[L],1,1,()=>{P[L]=null}),ge(),b=P[u],b?b.p(r,p):(b=P[u]=U[u](r),b.c()),y(b,1),b.m(v.parentNode,v)),p&64&&(E.checked=r[6]);const q={};!A&&p&2&&(A=!0,q.cost=r[1],le(()=>A=!1)),j.$set(q)},i(r){G||(y(b),y(j.$$.fragment,r),G=!0)},o(r){k(b),k(j.$$.fragment,r),G=!1},d(r){r&&(w(e),w(n),w(t),w(g),w(v),w(O),w(c),w(d),w(M)),P[u].d(r),F(j,r),X=!1,Se(z)}}}function Xe(o){let e,n;return e=new Oe({props:{colorScale:te,limits:K(o[5],o[9],o[10]),decimalPlaces:1}}),{c(){C(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,s){const l={};s&1568&&(l.limits=K(t[5],t[9],t[10])),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ze(o){let e,n,t,s;return e=new je({props:{rows:[[`${J.lts1}: ${o[8][1].toFixed(0)}% of roads by distance`,T.lts1],[`${J.lts2}: ${o[8][2].toFixed(0)}%`,T.lts2],[`${J.lts3}: ${o[8][3].toFixed(0)}%`,T.lts3],[`${J.lts4}: ${o[8][4].toFixed(0)}%`,T.lts4]]}}),{c(){C(e.$$.fragment),n=B(),t=_("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(l,i){S(e,l,i),h(l,n,i),h(l,t,i),s=!0},p(l,i){const a={};i&256&&(a.rows=[[`${J.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,T.lts1],[`${J.lts2}: ${l[8][2].toFixed(0)}%`,T.lts2],[`${J.lts3}: ${l[8][3].toFixed(0)}%`,T.lts3],[`${J.lts4}: ${l[8][4].toFixed(0)}%`,T.lts4]]),e.$set(a)},i(l){s||(y(e.$$.fragment,l),s=!0)},o(l){k(e.$$.fragment,l),s=!1},d(l){l&&(w(n),w(t)),F(e,l)}}}function Ue(o){let e,n,t,s,l,i,a,f,$,g,u,b,v,O,N;function E(d){o[18](d)}let D={};o[0]!==void 0&&(D.example=o[0]),f=new Ne({props:D}),Q.push(()=>ne(f,"example",E)),u=new Pe({props:{map:o[2]}}),u.$on("gotXml",o[15]),u.$on("loading",o[19]),u.$on("error",o[20]);let c=o[3]&&pe(o);return{c(){e=_("div"),n=_("label"),t=R("Open an "),s=_("i"),s.textContent=".osm.pbf",l=R(`
      file
      `),i=_("input"),a=B(),C(f.$$.fragment),g=B(),C(u.$$.fragment),b=B(),c&&c.c(),I(i,"type","file"),I(e,"slot","left")},m(d,M){h(d,e,M),m(e,n),m(n,t),m(n,s),m(n,l),m(n,i),o[17](i),m(e,a),S(f,e,null),m(e,g),S(u,e,null),m(e,b),c&&c.m(e,null),v=!0,O||(N=ee(i,"change",o[12]),O=!0)},p(d,M){const j={};!$&&M&1&&($=!0,j.example=d[0],le(()=>$=!1)),f.$set(j);const A={};M&4&&(A.map=d[2]),u.$set(A),d[3]?c?(c.p(d,M),M&8&&y(c,1)):(c=pe(d),c.c(),y(c,1),c.m(e,null)):c&&(de(),k(c,1,1,()=>{c=null}),ge())},i(d){v||(y(f.$$.fragment,d),y(u.$$.fragment,d),y(c),v=!0)},o(d){k(f.$$.fragment,d),k(u.$$.fragment,d),k(c),v=!1},d(d){d&&w(e),o[17](null),F(f),F(u),c&&c.d(),O=!1,N()}}}function We(o){let e,n,t;return n=new Ie({props:{properties:o[28]}}),{c(){e=_("div"),C(n.$$.fragment),H(e,"max-width","30vw"),H(e,"max-height","60vh"),H(e,"overflow","auto")},m(s,l){h(s,e,l),S(n,e,null),t=!0},p(s,l){const i={};l&268435456&&(i.properties=s[28]),n.$set(i)},i(s){t||(y(n.$$.fragment,s),t=!0)},o(s){k(n.$$.fragment,s),t=!1},d(s){s&&w(e),F(n)}}}function Ze(o){let e,n;return e=new Ee({props:{$$slots:{default:[We,({props:t})=>({28:t}),({props:t})=>t?268435456:0]},$$scope:{ctx:o}}}),{c(){C(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,s){const l={};s&805306368&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ke(o){let e,n;return e=new Be({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":o[13](o[5],o[9],o[10]),"line-opacity":o[14](o[5],o[6])},beforeId:"Road labels",$$slots:{default:[Ze]},$$scope:{ctx:o}}}),e.$on("click",xe),{c(){C(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,s){const l={};s&1632&&(l.paint={"line-width":5,"line-color":t[13](t[5],t[9],t[10]),"line-opacity":t[14](t[5],t[6])}),s&536870912&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Qe(o){let e,n,t,s;return e=new Je({props:{data:o[4],$$slots:{default:[Ke]},$$scope:{ctx:o}}}),t=new De({}),{c(){C(e.$$.fragment),n=B(),C(t.$$.fragment)},m(l,i){S(e,l,i),h(l,n,i),S(t,l,i),s=!0},p(l,i){const a={};i&16&&(a.data=l[4]),i&536872544&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){s||(y(e.$$.fragment,l),y(t.$$.fragment,l),s=!0)},o(l){k(e.$$.fragment,l),k(t.$$.fragment,l),s=!1},d(l){l&&w(n),F(e,l),F(t,l)}}}function Ve(o){let e,n,t,s;function l(a){o[16](a)}let i={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Qe]},$$scope:{ctx:o}};return o[2]!==void 0&&(i.map=o[2]),n=new ye({props:i}),Q.push(()=>ne(n,"map",l)),{c(){e=_("div"),C(n.$$.fragment),I(e,"slot","main"),H(e,"position","relative"),H(e,"width","100%"),H(e,"height","100vh")},m(a,f){h(a,e,f),S(n,e,null),s=!0},p(a,f){const $={};f&536872560&&($.$$scope={dirty:f,ctx:a}),!t&&f&4&&(t=!0,$.map=a[2],le(()=>t=!1)),n.$set($)},i(a){s||(y(n.$$.fragment,a),s=!0)},o(a){k(n.$$.fragment,a),s=!1},d(a){a&&w(e),F(n)}}}function Ye(o){let e,n,t,s;return e=new be({props:{$$slots:{main:[Ve],left:[Ue],top:[Re]},$$scope:{ctx:o}}}),t=new Me({props:{loading:o[7]}}),{c(){C(e.$$.fragment),n=B(),C(t.$$.fragment)},m(l,i){S(e,l,i),h(l,n,i),S(t,l,i),s=!0},p(l,[i]){const a={};i&536875007&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const f={};i&128&&(f.loading=l[7]),t.$set(f)},i(l){s||(y(e.$$.fragment,l),y(t.$$.fragment,l),s=!0)},o(l){k(e.$$.fragment,l),k(t.$$.fragment,l),s=!1},d(l){l&&w(n),F(e,l),F(t,l)}}}function xe(o){let e=o.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function K(o,e,n){if(o=="lts")return[];if(o=="cost")return ue(0,e);if(o=="nearby_amenities")return ue(0,n);throw new Error("unreachable")}function ue(o,e){let n=[],t=(e-o)/5;for(let s=0;s<6;s++)n.push(o+s*t);return n}function et(o,e,n){he(async()=>{await qe(),await ke()});let t,s,l="",i={type:"FeatureCollection",features:[]},a="Distance",f="cost",$=!1,g="",u=[0,0,0,0,0],b=1,v=1,O;async function N(r){n(0,l=""),n(7,g="Loading file"),E(await O.files[0].arrayBuffer())}function E(r){try{n(3,s=new Te(new Uint8Array(r))),n(1,a="Distance");let p=s.getBounds();t.fitBounds([[p[0],p[1]],[p[2],p[3]]],{padding:20,animate:!1}),c()}catch(p){window.alert(`Problem importing osm.pbf file: ${p}`)}n(7,g="")}async function D(r){if(r!=""){n(7,g=`Loading ${r}`);let p=await fetch(`https://assets.od2net.org/pbf_clips/${r}.osm.pbf`);E(await p.arrayBuffer())}}function c(){n(4,i=JSON.parse(s.debugNetwork()));let r=0,p=[0,0,0,0,0];n(9,b=0),n(10,v=0);for(let L of i.features){let q=L.properties;n(10,v=Math.max(v,q.nearby_amenities)),q.length&&(n(9,b=Math.max(b,q.forward_cost/q.length)),r+=q.length,p[q.lts]+=q.length)}n(8,u=p.map(L=>L/r*100))}function d(r,p,L){if(r=="lts")return ve;if(r=="cost")return["case",["==",0,["get","lts"]],T.lts_not_allowed,re(["/",["get","forward_cost"],["get","length"]],K(r,p,L),te)];if(r=="nearby_amenities")return re(["get","nearby_amenities"],K(r,p,L),te);throw new Error("unreachable")}function M(r,p){let L=Fe(1,.5);return r=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,L]:p?L:["case",["==",0,["get","lts"]],0,L]}function j(r){n(7,g="Parsing XML"),E(new TextEncoder().encode(r.detail)),n(7,g="")}function A(r){s&&(s.updateCostFunction(r),c())}function G(r){t=r,n(2,t)}function X(r){Q[r?"unshift":"push"](()=>{O=r,n(11,O)})}function z(r){l=r,n(0,l)}const U=r=>n(7,g=r.detail),P=r=>n(7,g=r.detail);function W(){f=Le(this),n(5,f)}function V(){$=this.checked,n(6,$)}function Z(r){a=r,n(1,a)}return o.$$.update=()=>{o.$$.dirty&1&&D(l),o.$$.dirty&2&&A(a)},[l,a,t,s,i,f,$,g,u,b,v,O,N,d,M,j,G,X,z,U,P,W,V,Z]}class tt extends ce{constructor(e){super(),_e(this,e,et,Ye,me,{})}}new tt({target:document.getElementById("app")});
